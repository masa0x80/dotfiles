#!/bin/zsh

aws-ssh() {
  type aws >/dev/null || return 1
  type fzf >/dev/null || return 1
  type xpanes >/dev/null || return 1

  hosts=$(aws ec2 describe-instances --filter Name=instance-state-name,Values=running --query 'Reservations[].Instances[].[join(`\t`, [PrivateIpAddress, join(`\t`, [Tags[].join(`:`, *)][])])]' --output text | fzf --query "$*" | cut -f 1)
  if [ "$hosts" != '' ]; then
    xpanes --ssh $hosts
  fi
}
aws-ssh
