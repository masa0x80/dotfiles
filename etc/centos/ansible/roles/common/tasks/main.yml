- include: yum_settings.yml
  tags: yum_settings
- include: yum_update.yml
  tags: yum_update
- include: basic_tools.yml
  tags: basic_tools

- name: check fzf
  stat: path={{ home_dir }}/.fzf
  register: fzf
  tags: fzf
- include: fzf.yml
  when: fzf.stat.exists == False
  tags: fzf

- name: check direnv
  stat: path={{ bin_dir }}/direnv
  register: direnv
  tags: direnv
- include: direnv.yml
  when: direnv.stat.exists == False
  tags: direnv

- name: check pt
  stat: path={{ bin_dir }}/pt
  register: pt
  tags: pt
- include: pt.yml
  when: pt.stat.exists == False
  tags: pt

- name: check ruby version
  stat: path={{ home_dir }}/.anyenv/envs/rbenv
  register: rbenv_dir
  tags: rbenv
- include: rbenv.yml
  when: rbenv_dir.stat.exists == False
  tags: rbenv

- name: check mysql version
  shell: mysql --version | sed -e 's/.*Distrib \([0-9.]\+\), .\+/\1/'
  register: installed_mysql_version
  tags: mysql
- name: check mysql
  shell: PATH=$PATH:{{ bin_dir }} type -a mysql
  register: mysql
  failed_when:  mysql.rc not in [0, 1]
  changed_when: mysql.rc not in [0, 1]
  tags: mysql
- include: mysql.yml
  when: mysql|failed or installed_mysql_version.stdout | version_compare(mysql_version, '<')
  tags: mysql
